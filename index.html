<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfolio Bac 3 – 60h (Soft skills + IT)</title>
  <meta name="description" content="Portfolio Bac 3 – suivi des 60h (10h soft skills, 50h informatique) avec pièces justificatives et calcul automatique du plafond de 10h par formation." />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1020;--card:#0f172a;--muted:#94a3b8;--accent:#22d3ee}
    html,body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:linear-gradient(180deg,#0b1020,#0b1020 40%,#0e1326);color:#e5e7eb}
    .glass{background:rgba(15,23,42,.7);backdrop-filter:blur(8px);border:1px solid rgba(148,163,184,.15)}
    .chip{border:1px solid rgba(148,163,184,.2)}
    .ring-accent{box-shadow:0 0 0 3px rgba(34,211,238,.25)}
    @media print{.no-print{display:none!important} .print\:block{display:block!important}}
  </style>
</head>
<body class="min-h-screen">
  <header class="sticky top-0 z-40 glass">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-3">
      <div class="w-9 h-9 rounded-2xl bg-cyan-300/20 grid place-items-center text-cyan-300 font-bold">B3</div>
      <div>
        <h1 class="text-xl font-semibold">Portfolio Bac 3</h1>
        <p class="text-sm text-slate-400">Objectif: <span class="font-semibold">60h</span> • <span class="text-cyan-300">10h</span> soft skills • <span class="text-cyan-300">50h</span> informatique</p>
      </div>
      <div class="ml-auto flex gap-2 no-print">
        <button id="btnExport" class="px-3 py-2 rounded-xl bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-400/30 text-cyan-200 text-sm">Exporter JSON</button>
        <label class="px-3 py-2 rounded-xl bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600/50 text-slate-200 text-sm cursor-pointer">
          Importer JSON
          <input id="importFile" type="file" accept="application/json" class="hidden" />
        </label>
        <button onclick="window.print()" class="px-3 py-2 rounded-xl bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600/50 text-slate-200 text-sm">Imprimer / PDF</button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8 space-y-8">
    <!-- HERO / PRESENTATION -->
    <section class="grid md:grid-cols-[1.2fr,1fr] gap-6">
      <div class="glass rounded-3xl p-6">
        <h2 class="text-lg font-semibold mb-4">À propos</h2>
        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <label class="text-xs uppercase tracking-wide text-slate-400">Nom</label>
            <input id="studentName" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" placeholder="Votre nom complet" />
          </div>
          <div>
            <label class="text-xs uppercase tracking-wide text-slate-400">Email</label>
            <input id="studentEmail" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" placeholder="prenom.nom@exemple.be" />
          </div>
          <div>
            <label class="text-xs uppercase tracking-wide text-slate-400">Établissement</label>
            <input id="studentSchool" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" placeholder="EPHEC – TI" />
          </div>
          <div>
            <label class="text-xs uppercase tracking-wide text-slate-400">Année</label>
            <input id="studentYear" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" placeholder="Bac 3 – 2025" />
          </div>
        </div>
        <label class="block mt-4 text-xs uppercase tracking-wide text-slate-400">Résumé</label>
        <textarea id="studentSummary" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" rows="3" placeholder="Quelques lignes sur vos objectifs, votre projet pro, et ce que couvrent vos 60h..."></textarea>
      </div>

      <div class="glass rounded-3xl p-6">
        <h2 class="text-lg font-semibold">Progression</h2>
        <p class="text-sm text-slate-400 mb-3">Le calcul respecte le plafond: <span class="font-semibold">une formation >10h ne compte que 10h</span>.</p>
        <div class="space-y-3">
          <div>
            <div class="flex justify-between text-sm"><span>Soft skills</span><span id="softCount">0 / 10h</span></div>
            <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden"><div id="softBar" class="h-2 bg-cyan-400" style="width:0%"></div></div>
          </div>
          <div>
            <div class="flex justify-between text-sm"><span>Informatique</span><span id="techCount">0 / 50h</span></div>
            <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden"><div id="techBar" class="h-2 bg-cyan-400" style="width:0%"></div></div>
          </div>
          <div class="pt-1 text-sm" id="totalInfo">Total comptabilisé: 0 / 60h</div>
          <div id="warnings" class="text-amber-300 text-sm"></div>
        </div>
      </div>
    </section>

    <!-- ADD ENTRY FORM -->
    <section class="glass rounded-3xl p-6 no-print">
      <h2 class="text-lg font-semibold mb-4">Ajouter une activité</h2>
      <form id="entryForm" class="grid md:grid-cols-4 gap-4">
        <div class="md:col-span-2">
          <label class="text-xs uppercase tracking-wide text-slate-400">Titre de l’activité</label>
          <input name="title" required class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" placeholder="Ex: Atelier prise de parole / Développement d’une API" />
        </div>
        <div>
          <label class="text-xs uppercase tracking-wide text-slate-400">Catégorie</label>
          <select name="category" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2">
            <option value="soft">Soft skills</option>
            <option value="tech">Informatique</option>
          </select>
        </div>
        <div>
          <label class="text-xs uppercase tracking-wide text-slate-400">Type</label>
          <select name="type" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2">
            <option value="training">Formation</option>
            <option value="project">Projet</option>
            <option value="event">Événement</option>
            <option value="volunteering">Bénévolat</option>
            <option value="other">Autre</option>
          </select>
        </div>
        <div> 
          <label class="text-xs uppercase tracking-wide text-slate-400">Heures réelles</label>
          <input type="number" min="0" step="0.5" name="hours" required class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" placeholder="Ex: 2" />
        </div>
        <div>
          <label class="text-xs uppercase tracking-wide text-slate-400">Date</label>
          <input type="date" name="date" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" />
        </div>
        <div class="md:col-span-2">
          <label class="text-xs uppercase tracking-wide text-slate-400">Description</label>
          <input name="description" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" placeholder="Ce que vous avez fait / appris" />
        </div>
        <div class="md:col-span-3">
          <label class="text-xs uppercase tracking-wide text-slate-400">Preuves (liens séparés par des virgules)</label>
          <input name="links" class="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" placeholder="GitHub, certificats, vidéos, slides..." />
        </div>
        <div class="flex items-end">
          <button class="px-4 py-2 rounded-xl bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-400/30 text-cyan-200">Ajouter</button>
        </div>
      </form>
    </section>

    <!-- FILTERS -->
    <section class="no-print flex flex-wrap gap-2">
      <button data-filter="all" class="filter-btn chip px-3 py-1 rounded-full text-sm">Tout</button>
      <button data-filter="soft" class="filter-btn chip px-3 py-1 rounded-full text-sm">Soft skills</button>
      <button data-filter="tech" class="filter-btn chip px-3 py-1 rounded-full text-sm">Informatique</button>
      <button data-filter="training" class="filter-btn chip px-3 py-1 rounded-full text-sm">Formations</button>
      <button data-filter="project" class="filter-btn chip px-3 py-1 rounded-full text-sm">Projets</button>
      <button data-filter="event" class="filter-btn chip px-3 py-1 rounded-full text-sm">Événements</button>
      <button data-filter="volunteering" class="filter-btn chip px-3 py-1 rounded-full text-sm">Bénévolat</button>
    </section>

    <!-- ENTRIES LIST -->
    <section id="entries" class="grid md:grid-cols-2 gap-4"></section>

    <!-- SUMMARY TABLE -->
    <section class="glass rounded-3xl p-6">
      <h2 class="text-lg font-semibold mb-4">Tableau récapitulatif</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="text-slate-300">
            <tr>
              <th class="text-left py-2">Titre</th>
              <th class="text-left">Catégorie</th>
              <th class="text-left">Type</th>
              <th class="text-right">Heures réelles</th>
              <th class="text-right">Heures comptées</th>
              <th class="text-left">Date</th>
            </tr>
          </thead>
          <tbody id="summaryRows"></tbody>
        </table>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="text-center text-slate-500 pb-10">
      <p>Fait avec ♥ pour le portfolio Bac 3 — Thème GitHub Pages statique (HTML/JS) — Imprimez en PDF pour remise.</p>
    </footer>
  </main>

  <script>
    // --------- Data Model ---------
    const STORAGE_KEY = 'b3_portfolio_v1';

    /** @type {{meta:{name:string,email:string,school:string,year:string,summary:string}, items:Array<{id:string,title:string,category:'soft'|'tech',type:'training'|'project'|'event'|'volunteering'|'other',hours:number,date?:string,description?:string,links?:string[]}>}} */
    const state = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null') || {
      meta:{name:'',email:'',school:'',year:'',summary:''},
      items:[
        // Exemples (supprimez-les quand vous avez vos vraies activités)
        {id:crypto.randomUUID(), title:'Atelier prise de parole', category:'soft', type:'training', hours:6, date:'2025-03-15', description:'Gestion du trac, posture, voix', links:[]},
        {id:crypto.randomUUID(), title:'Projet MERN – PowerTrack', category:'tech', type:'project', hours:18, date:'2025-04-19', description:'Backend Express + WebSocket, MongoDB, dashboard React', links:['https://github.com/user/powertrack']},
        {id:crypto.randomUUID(), title:'Formation Udemy – Docker & DevOps (25h)', category:'tech', type:'training', hours:25, date:'2025-05-01', description:'CI/CD, Docker Compose, Nginx, TLS', links:['https://certificate.example']}
      ]
    };

    // --------- Helpers ---------
    const el = sel => document.querySelector(sel);
    const els = sel => [...document.querySelectorAll(sel)];

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    function hoursCounted(item){
      // Règle: pour les formations, max 10h comptabilisées
      if(item.type === 'training') return Math.min(item.hours, 10);
      return item.hours;
    }

    function computeTotals(){
      let soft=0, tech=0;
      for(const it of state.items){
        const counted = hoursCounted(it);
        if(it.category==='soft') soft += counted; else tech += counted;
      }
      return {soft, tech, total: soft+tech};
    }

    function formatHours(h){
      return (Math.round(h*2)/2).toLocaleString('fr-BE', {minimumFractionDigits: (h%1?1:0)});
    }

    function setProgress(){
      const {soft,tech,total} = computeTotals();
      el('#softCount').textContent = `${formatHours(soft)} / 10h`;
      el('#techCount').textContent = `${formatHours(tech)} / 50h`;
      el('#totalInfo').textContent = `Total comptabilisé: ${formatHours(total)} / 60h`;
      el('#softBar').style.width = Math.min(100, soft/10*100) + '%';
      el('#techBar').style.width = Math.min(100, tech/50*100) + '%';

      const warns = [];
      if(soft>10) warns.push('Vous avez dépassé 10h en soft skills (le surplus ne comptera pas).');
      if(tech>50) warns.push('Vous avez dépassé 50h en informatique (le surplus ne comptera pas).');
      if(total<60) warns.push(`Il manque ${formatHours(60-total)}h pour atteindre 60h.`);
      if(total>60) warns.push(`Vous dépassez 60h (ok, mais only 60h seront comptées).`);
      el('#warnings').innerHTML = warns.map(w=>`• ${w}`).join('<br>');
    }

    function badge(text){
      return `<span class="chip inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs text-slate-300">${text}</span>`;
    }

    function renderEntries(filter='all'){
      const wrap = el('#entries');
      wrap.innerHTML = '';
      const items = state.items
        .slice()
        .sort((a,b)=> (b.date||'').localeCompare(a.date||''));

      for(const item of items){
        const counted = hoursCounted(item);
        const show = (
          filter==='all' ||
          filter===item.category ||
          filter===item.type
        );
        if(!show) continue;

        const card = document.createElement('article');
        card.className = 'glass rounded-3xl p-5 space-y-3';
        card.innerHTML = `
          <div class="flex items-start gap-3">
            <div class="w-10 h-10 rounded-2xl bg-cyan-300/20 grid place-items-center text-cyan-300 font-bold">${item.category==='soft'?'S':'IT'}</div>
            <div class="flex-1">
              <h3 class="font-semibold text-lg">${escapeHtml(item.title)}</h3>
              <div class="flex flex-wrap gap-2 mt-1">
                ${badge(item.category==='soft'?'Soft skills':'Informatique')}
                ${badge(item.type.charAt(0).toUpperCase()+item.type.slice(1))}
                ${badge(`${formatHours(item.hours)}h réelles`)}
                ${badge(`${formatHours(counted)}h comptées`)}
                ${item.date? badge(new Date(item.date).toLocaleDateString('fr-BE')):''}
              </div>
            </div>
            <div class="no-print flex gap-2">
              <button class="px-2 py-1 rounded-lg bg-slate-700/60 hover:bg-slate-700 text-xs" data-edit="${item.id}">Éditer</button>
              <button class="px-2 py-1 rounded-lg bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 text-red-200 text-xs" data-del="${item.id}">Suppr</button>
            </div>
          </div>
          ${item.description? `<p class="text-slate-300">${escapeHtml(item.description)}</p>`:''}
          ${Array.isArray(item.links) && item.links.length? `<div class="flex flex-wrap gap-2">${item.links.map(l=>`<a class='underline text-cyan-300' href='${escapeAttr(l)}' target='_blank' rel='noopener'>Preuve</a>`).join('')}</div>`:''}
        `;
        wrap.appendChild(card);
      }

      // wire edit/delete
      wrap.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const id = btn.getAttribute('data-del');
          const idx = state.items.findIndex(i=>i.id===id);
          if(idx>-1){ state.items.splice(idx,1); save(); setProgress(); renderEntries(currentFilter); renderSummary(); }
        });
      });

      wrap.querySelectorAll('[data-edit]').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const id = btn.getAttribute('data-edit');
          const it = state.items.find(i=>i.id===id);
          if(!it) return;
          // Preload form
          const f = el('#entryForm');
          f.title.value = it.title;
          f.category.value = it.category;
          f.type.value = it.type;
          f.hours.value = it.hours;
          f.date.value = it.date||'';
          f.description.value = it.description||'';
          f.links.value = (it.links||[]).join(', ');
          f.setAttribute('data-editing', id);
          f.querySelector('button').textContent = 'Mettre à jour';
          f.classList.add('ring-accent');
          f.scrollIntoView({behavior:'smooth', block:'center'});
        });
      });
    }

    function renderSummary(){
      const body = el('#summaryRows');
      body.innerHTML = '';
      const items = state.items.slice().sort((a,b)=> (a.title.localeCompare(b.title)));
      for(const it of items){
        const tr = document.createElement('tr');
        tr.className = 'border-t border-slate-700/50';
        tr.innerHTML = `
          <td class="py-2">${escapeHtml(it.title)}</td>
          <td>${it.category==='soft'?'Soft':'IT'}</td>
          <td>${it.type}</td>
          <td class="text-right">${formatHours(it.hours)}</td>
          <td class="text-right">${formatHours(hoursCounted(it))}</td>
          <td>${it.date? new Date(it.date).toLocaleDateString('fr-BE'):''}</td>
        `;
        body.appendChild(tr);
      }
    }

    // --------- Form & Filters ---------
    const form = el('#entryForm');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = new FormData(form);
      const entry = {
        id: form.getAttribute('data-editing') || crypto.randomUUID(),
        title: (data.get('title')||'').toString().trim(),
        category: data.get('category'),
        type: data.get('type'),
        hours: Number(data.get('hours'))||0,
        date: (data.get('date')||'').toString(),
        description: (data.get('description')||'').toString().trim(),
        links: (data.get('links')||'').toString().split(',').map(s=>s.trim()).filter(Boolean)
      };

      const editingId = form.getAttribute('data-editing');
      if(editingId){
        const idx = state.items.findIndex(i=>i.id===editingId);
        if(idx>-1) state.items[idx] = entry;
        form.removeAttribute('data-editing');
        form.querySelector('button').textContent = 'Ajouter';
        form.classList.remove('ring-accent');
      } else {
        state.items.push(entry);
      }

      save();
      setProgress();
      renderEntries(currentFilter);
      renderSummary();
      form.reset();
    });

    let currentFilter = 'all';
    els('.filter-btn').forEach(b=>{
      b.addEventListener('click',()=>{
        currentFilter = b.getAttribute('data-filter');
        renderEntries(currentFilter);
        els('.filter-btn').forEach(x=>x.classList.remove('bg-cyan-500/20'));
        b.classList.add('bg-cyan-500/20');
      })
    });

    // --------- Meta (About) ---------
    function syncMetaInputs(){
      el('#studentName').value = state.meta.name||'';
      el('#studentEmail').value = state.meta.email||'';
      el('#studentSchool').value = state.meta.school||'';
      el('#studentYear').value = state.meta.year||'';
      el('#studentSummary').value = state.meta.summary||'';
    }

    ['studentName','studentEmail','studentSchool','studentYear','studentSummary'].forEach(id=>{
      el('#'+id).addEventListener('input', ()=>{
        state.meta.name = el('#studentName').value.trim();
        state.meta.email = el('#studentEmail').value.trim();
        state.meta.school = el('#studentSchool').value.trim();
        state.meta.year = el('#studentYear').value.trim();
        state.meta.summary = el('#studentSummary').value.trim();
        save();
      });
    });

    // --------- Export / Import ---------
    el('#btnExport').addEventListener('click',()=>{
      const blob = new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'portfolio_bac3.json'; a.click();
      URL.revokeObjectURL(url);
    });

    el('#importFile').addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(reader.result);
          if(!data || !data.items) throw new Error('Fichier invalide');
          state.meta = data.meta||{}; state.items = data.items||[];
          save(); syncMetaInputs(); setProgress(); renderEntries(currentFilter); renderSummary();
        }catch(err){ alert('Erreur à l\'import: '+err.message); }
      };
      reader.readAsText(file);
      e.target.value='';
    });

    // --------- Security helpers ---------
    function escapeHtml(str=''){
      return str.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }
    function escapeAttr(str=''){
      return str.replace(/["']/g, c => ({'"':'&quot;','\'':'&#39;'}[c]));
    }

    // --------- Init ---------
    syncMetaInputs();
    setProgress();
    renderEntries('all');
    renderSummary();
  </script>
</body>
</html>
