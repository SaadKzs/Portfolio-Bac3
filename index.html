<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Portfolio Bac3 – React</title>
  <meta name="description" content="Portfolio Bac3 (60h) en React, un seul fichier, hébergeable sur GitHub Pages. LocalStorage + export/import JSON, impression PDF, plafonds d'heures.">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1020;--card:#0f172a;--muted:#94a3b8;--accent:#06b6d4}
    html,body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:radial-gradient(1200px 600px at 10% -10%,rgba(34,211,238,.10),transparent 40%),radial-gradient(1200px 600px at 110% 10%,rgba(34,211,238,.08),transparent 40%),#0b1020;color:#e5e7eb}
    .glass{background:rgba(15,23,42,.75);backdrop-filter:blur(8px);border:1px solid rgba(148,163,184,.15)}
    .chip{border:1px solid rgba(148,163,184,.2)}
    .ring-accent{box-shadow:0 0 0 3px rgba(34,211,238,.25)}
    .btn{border:1px solid rgba(34,211,238,.2)}
    @media print{.no-print{display:none!important} .print\:block{display:block!important}}
  </style>
  <!-- React CDN + Babel (pour JSX dans un seul fichier) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const {useState, useMemo, useEffect, useRef} = React;

    const STORAGE_KEY = 'b3_portfolio_react_v1';

    const defaultState = {
      meta: {name:'', email:'', school:'EPHEC – TI', year:'Bac 3 – 2025', summary:''},
      items: []
    };

    const capCounted = (item) => item.type === 'training' ? Math.min(item.hours, 10) : item.hours;

    function usePortfolio(){
      const [data, setData] = useState(()=>{
        try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultState; }catch{ return defaultState; }
      });
      useEffect(()=>{ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }, [data]);
      return [data, setData];
    }

    function Progress({soft, tech}){
      const total = soft + tech;
      return (
        <div className="space-y-3">
          <div>
            <div className="flex justify-between text-sm"><span>Soft skills</span><span>{soft} / 10h</span></div>
            <div className="w-full h-2 bg-slate-800 rounded-full overflow-hidden"><div className="h-2 bg-cyan-400" style={{width: Math.min(100, soft/10*100)+"%"}}/></div>
          </div>
          <div>
            <div className="flex justify-between text-sm"><span>Informatique</span><span>{tech} / 50h</span></div>
            <div className="w-full h-2 bg-slate-800 rounded-full overflow-hidden"><div className="h-2 bg-cyan-400" style={{width: Math.min(100, tech/50*100)+"%"}}/></div>
          </div>
          <div className="text-sm">Total comptabilisé: {total} / 60h</div>
        </div>
      );
    }

    function Modal({open, onClose, title, children}){
      if(!open) return null;
      return (
        <div className="fixed inset-0 z-50 grid place-items-center">
          <div className="absolute inset-0 bg-black/40" onClick={onClose}/>
          <div className="relative glass rounded-2xl p-5 w-[min(680px,92vw)]">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-lg font-semibold">{title}</h3>
              <button className="px-3 py-1 rounded-lg bg-slate-700 hover:bg-slate-600" onClick={onClose}>✕</button>
            </div>
            {children}
          </div>
        </div>
      );
    }

    function App(){
      const [data, setData] = usePortfolio();
      const [filter, setFilter] = useState('all');
      const [openForm, setOpenForm] = useState(false);
      const [editId, setEditId] = useState(null);

      const itemsSorted = useMemo(()=> data.items.slice().sort((a,b)=>(b.date||'').localeCompare(a.date||'')), [data.items]);

      const totals = useMemo(()=>{
        let soft=0, tech=0; 
        for(const it of data.items){
          const c = capCounted(it);
          if(it.category==='soft') soft+=c; else tech+=c;
        }
        soft = Math.round(soft*2)/2; tech = Math.round(tech*2)/2;
        return {soft, tech};
      }, [data.items]);

      const warnings = useMemo(()=>{
        const arr=[]; const total = totals.soft + totals.tech;
        if(totals.soft>10) arr.push('Soft skills > 10h : le surplus ne comptera pas.');
        if(totals.tech>50) arr.push('Informatique > 50h : le surplus ne comptera pas.');
        if(total<60) arr.push(`Il manque ${Math.round((60-total)*2)/2}h pour atteindre 60h.`);
        if(total>60) arr.push(`Vous dépassez 60h (seules 60h seront comptées).`);
        return arr;
      }, [totals]);

      function onSaveItem(item){
        setData(s=>{
          const items = s.items.slice();
          if(item.id){
            const idx = items.findIndex(i=>i.id===item.id);
            if(idx>-1) items[idx]=item;
          } else {
            item.id = crypto.randomUUID();
            items.push(item);
          }
          return {...s, items};
        });
        setOpenForm(false); setEditId(null);
      }

      function onDelete(id){
        setData(s=>({...s, items: s.items.filter(i=>i.id!==id)}));
      }

      function onExport(){
        const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href=url; a.download='portfolio_bac3.json'; a.click(); URL.revokeObjectURL(url);
      }

      function onImport(e){
        const file = e.target.files?.[0]; if(!file) return;
        const rd = new FileReader();
        rd.onload = () => { try{ setData(JSON.parse(rd.result)); } catch(err){ alert('Fichier invalide'); } };
        rd.readAsText(file);
        e.target.value='';
      }

      function onPrint(){ window.print(); }

      return (
        <div className="max-w-6xl mx-auto px-4 py-6">
          <header className="sticky top-0 z-40 glass rounded-2xl px-4 py-3 mb-6">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-2xl bg-cyan-400/20 grid place-items-center text-cyan-300 font-extrabold">B3</div>
              <div>
                <h1 className="text-xl font-semibold">Portfolio Bac 3</h1>
                <p className="text-xs text-slate-400">Objectif: 60h — <span className="text-cyan-300">10h</span> soft • <span className="text-cyan-300">50h</span> IT</p>
              </div>
              <div className="ml-auto flex gap-2 no-print">
                <button className="btn px-3 py-1.5 rounded-xl bg-cyan-500/20 hover:bg-cyan-500/30" onClick={()=>{setOpenForm(true); setEditId(null);}}>+ Ajouter</button>
                <button className="btn px-3 py-1.5 rounded-xl" onClick={onExport}>Exporter JSON</button>
                <label className="btn px-3 py-1.5 rounded-xl cursor-pointer">Importer JSON
                  <input type="file" accept="application/json" className="hidden" onChange={onImport}/>
                </label>
                <button className="btn px-3 py-1.5 rounded-xl" onClick={onPrint}>Imprimer / PDF</button>
              </div>
            </div>
          </header>

          <section className="grid md:grid-cols-[1.1fr,1fr] gap-6">
            <div className="glass rounded-2xl p-5">
              <h2 className="text-lg font-semibold mb-3">À propos</h2>
              <div className="grid sm:grid-cols-2 gap-4">
                <TextField label="Nom" value={data.meta.name} onChange={v=>setData(s=>({...s, meta:{...s.meta, name:v}}))}/>
                <TextField label="Email" value={data.meta.email} onChange={v=>setData(s=>({...s, meta:{...s.meta, email:v}}))}/>
                <TextField label="Établissement" value={data.meta.school} onChange={v=>setData(s=>({...s, meta:{...s.meta, school:v}}))}/>
                <TextField label="Année" value={data.meta.year} onChange={v=>setData(s=>({...s, meta:{...s.meta, year:v}}))}/>
              </div>
              <TextArea className="mt-3" label="Résumé" rows={3} value={data.meta.summary} onChange={v=>setData(s=>({...s, meta:{...s.meta, summary:v}}))}/>
            </div>

            <div className="glass rounded-2xl p-5">
              <h2 className="text-lg font-semibold mb-3">Progression</h2>
              <Progress soft={totals.soft} tech={totals.tech}/>
              {warnings.length>0 && (
                <div className="mt-3 text-amber-300 text-sm space-y-1">
                  {warnings.map((w,i)=>(<div key={i}>• {w}</div>))}
                </div>
              )}
            </div>
          </section>

          <section className="no-print mt-4 flex flex-wrap gap-2">
            {['all','soft','tech','training','project','event','volunteering','other'].map(k=> (
              <button key={k} onClick={()=>setFilter(k)} className={`chip px-3 py-1 rounded-full text-sm ${filter===k?'bg-cyan-500/20':''}`}>{k==='all'?'Tout':k}</button>
            ))}
          </section>

          <section className="grid md:grid-cols-2 gap-4 mt-4">
            {itemsSorted.filter(it=> filter==='all'|| filter===it.category || filter===it.type).map(it => (
              <Card key={it.id}
                item={it}
                onEdit={()=>{setEditId(it.id); setOpenForm(true);}}
                onDelete={()=>onDelete(it.id)}
              />
            ))}
            {itemsSorted.filter(it=> filter==='all'|| filter===it.category || filter===it.type).length===0 && (
              <div className="text-slate-400">Aucune activité. Ajoute ta première entrée avec « + Ajouter ».</div>
            )}
          </section>

          <section className="glass rounded-2xl p-5 mt-6">
            <h2 className="text-lg font-semibold mb-2">Tableau récapitulatif</h2>
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead className="text-slate-300">
                  <tr>
                    <th className="text-left py-2">Titre</th>
                    <th className="text-left">Catégorie</th>
                    <th className="text-left">Type</th>
                    <th className="text-right">Heures réelles</th>
                    <th className="text-right">Heures comptées</th>
                    <th className="text-left">Date</th>
                  </tr>
                </thead>
                <tbody>
                  {itemsSorted.map(it=> (
                    <tr key={it.id} className="border-t border-slate-700/50">
                      <td className="py-2">{it.title}</td>
                      <td>{it.category==='soft'?'Soft':'IT'}</td>
                      <td>{it.type}</td>
                      <td className="text-right">{it.hours}</td>
                      <td className="text-right">{capCounted(it)}</td>
                      <td>{it.date? new Date(it.date).toLocaleDateString('fr-BE'):''}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </section>

          <footer className="text-center text-slate-500 py-10">Fait avec ♥ — Version React (CDN) — Export JSON & Impression PDF.</footer>

          <Modal open={openForm} onClose={()=>{setOpenForm(false); setEditId(null);}} title={editId? 'Modifier une activité':'Ajouter une activité'}>
            <EntryForm
              item={data.items.find(i=>i.id===editId)}
              onSave={onSaveItem}
            />
          </Modal>
        </div>
      );
    }

    function TextField({label, value, onChange, className=''}){
      return (
        <div className={className}>
          <label className="text-xs uppercase tracking-wide text-slate-400">{label}</label>
          <input className="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2"
                 value={value||''} onChange={e=>onChange(e.target.value)} />
        </div>
      );
    }

    function TextArea({label, value, onChange, rows=3, className=''}){
      return (
        <div className={className}>
          <label className="text-xs uppercase tracking-wide text-slate-400">{label}</label>
          <textarea rows={rows} className="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2"
                 value={value||''} onChange={e=>onChange(e.target.value)} />
        </div>
      );
    }

    function Card({item, onEdit, onDelete}){
      return (
        <article className="glass rounded-2xl p-5 space-y-3">
          <div className="flex items-start gap-3">
            <div className="w-10 h-10 rounded-2xl bg-cyan-300/20 grid place-items-center text-cyan-300 font-bold">{item.category==='soft'?'S':'IT'}</div>
            <div className="flex-1">
              <h3 className="font-semibold text-lg">{item.title}</h3>
              <div className="flex flex-wrap gap-2 mt-1">
                <span className="chip inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs text-slate-300">{item.category==='soft'?'Soft skills':'Informatique'}</span>
                <span className="chip inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs text-slate-300">{item.type}</span>
                <span className="chip inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs text-slate-300">{item.hours}h réelles</span>
                <span className="chip inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs text-slate-300">{capCounted(item)}h comptées</span>
                {item.date && (<span className="chip inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs text-slate-300">{new Date(item.date).toLocaleDateString('fr-BE')}</span>)}
              </div>
            </div>
            <div className="no-print flex gap-2">
              <button className="px-2 py-1 rounded-lg bg-slate-700/60 hover:bg-slate-700 text-xs" onClick={onEdit}>Éditer</button>
              <button className="px-2 py-1 rounded-lg bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 text-red-200 text-xs" onClick={onDelete}>Suppr</button>
            </div>
          </div>
          {item.description && (<p className="text-slate-300">{item.description}</p>)}
          {Array.isArray(item.links) && item.links.length>0 && (
            <div className="flex flex-wrap gap-2">
              {item.links.map((l,idx)=> (<a key={idx} href={l} target="_blank" rel="noopener" className="underline text-cyan-300">Preuve</a>))}
            </div>
          )}
        </article>
      );
    }

    function EntryForm({item, onSave}){
      const [title, setTitle] = useState(item?.title||'');
      const [category, setCategory] = useState(item?.category||'soft');
      const [type, setType] = useState(item?.type||'training');
      const [hours, setHours] = useState(item?.hours||0);
      const [date, setDate] = useState(item?.date||'');
      const [description, setDescription] = useState(item?.description||'');
      const [links, setLinks] = useState(item?.links?.join(', ')||'');

      function handleSubmit(e){
        e.preventDefault();
        const obj = { id:item?.id, title, category, type, hours: Number(hours)||0, date, description, links: links.split(',').map(s=>s.trim()).filter(Boolean)};
        onSave(obj);
      }

      const counted = capCounted({type, hours: Number(hours)||0});

      return (
        <form className="grid md:grid-cols-4 gap-4" onSubmit={handleSubmit}>
          <div className="md:col-span-2"><TextField label="Titre de l’activité" value={title} onChange={setTitle}/></div>
          <div>
            <label className="text-xs uppercase tracking-wide text-slate-400">Catégorie</label>
            <select className="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" value={category} onChange={e=>setCategory(e.target.value)}>
              <option value="soft">Soft skills</option>
              <option value="tech">Informatique</option>
            </select>
          </div>
          <div>
            <label className="text-xs uppercase tracking-wide text-slate-400">Type</label>
            <select className="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" value={type} onChange={e=>setType(e.target.value)}>
              <option value="training">Formation</option>
              <option value="project">Projet</option>
              <option value="event">Événement</option>
              <option value="volunteering">Bénévolat</option>
              <option value="other">Autre</option>
            </select>
          </div>
          <div>
            <TextField label={`Heures réelles${type==='training' ? ' (plafond 10h)': ''}`} value={hours} onChange={setHours}/>
          </div>
          <div>
            <label className="text-xs uppercase tracking-wide text-slate-400">Date</label>
            <input type="date" className="w-full mt-1 rounded-xl bg-slate-800/60 border border-slate-700 px-3 py-2" value={date} onChange={e=>setDate(e.target.value)}/>
          </div>
          <div className="md:col-span-2"><TextField label="Description" value={description} onChange={setDescription}/></div>
          <div className="md:col-span-4"><TextField label="Preuves (liens séparés par des virgules)" value={links} onChange={setLinks}/></div>

          <div className="md:col-span-3 text-sm text-slate-400">Heures comptées: <span className="text-cyan-300 font-semibold">{counted}h</span></div>
          <div className="md:col-span-1 flex items-end justify-end">
            <button className="px-4 py-2 rounded-xl bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-400/30 text-cyan-200">{item? 'Mettre à jour':'Ajouter'}</button>
          </div>
        </form>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
</body>
</html>
